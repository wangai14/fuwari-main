---
import type { MarkdownHeading } from "astro";
import Categories from "./Categories.astro";
import Profile from "./Profile.astro";
import Tag from "./Tags.astro";

interface Props {
	class?: string;
	headings?: MarkdownHeading[];
}

const className = Astro.props.class;
---

<div id="sidebar" class:list={[className, "w-full"]}>
  <!-- ğŸ§ ä¸ªäººä¿¡æ¯ -->
  <div class="flex flex-col w-full gap-4 mb-4">
    <Profile />

    <!-- ğŸ‘ï¸ æµè§ˆç»Ÿè®¡ -->
    <div class="flex items-center text-sm text-white/60 dark:text-white/40 mt-2 px-1">
      <svg class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="none">
        <path
          d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5z"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <circle cx="12" cy="12" r="3" fill="currentColor" />
      </svg>
      <span id="sidebar-stats">ç»Ÿè®¡åŠ è½½ä¸­...</span>
    </div>
  </div>

  <!-- ğŸ“Œ ç½®é¡¶å†…å®¹ -->
  <div id="sidebar-sticky" class="transition-all duration-700 flex flex-col w-full gap-4 sticky top-4">
    <Categories class="onload-animation" style="animation-delay: 150ms" />
    <Tag class="onload-animation" style="animation-delay: 200ms" />

    <!-- âœ… æ¨å¹¿ iframe -->
    <iframe
      frameborder="0"
      src="https://support.nodeget.com/page/promotion?id=your_id"
      style="border-radius:8px; height: 270px;
            transform: scale(1.0); transform-origin: top left; width: 100%;">
    </iframe>
  </div>
</div>

<!-- ğŸ‘ï¸ æµè§ˆ/è®¿å®¢ç»Ÿè®¡è„šæœ¬ï¼ˆUmamiï¼‰ -->
<script is:inline>
  window.addEventListener("DOMContentLoaded", async () => {
    try {
      const res = await fetch("https://cloud.umami.is/api/websites/dc8728b4-fa5e-4191-981a-ab2bcb0dee27/stats");
      if (!res.ok) throw new Error("Umami è¯·æ±‚å¤±è´¥");

      const data = await res.json();
      const views = data.pageviews ?? 0;
      const visitors = data.uniques ?? 0;
      document.getElementById("sidebar-stats").textContent =
        `æµè§ˆé‡ ${views.toLocaleString()} Â· è®¿é—®é‡ ${visitors.toLocaleString()}`;
    } catch (e) {
      document.getElementById("sidebar-stats").textContent = "ç»Ÿè®¡åŠ è½½é”™è¯¯";
      console.error("ğŸ“Š Umami åŠ è½½å¤±è´¥ï¼š", e);
    }
  });
</script>
